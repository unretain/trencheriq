<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Join - Trencher IQ</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Courier New',monospace;background:#000;color:#0f0;min-height:100vh;display:flex;flex-direction:column}.navbar{background:#1a1a1a;border-bottom:2px solid #0f0;padding:20px 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}.nav-brand{display:flex;align-items:center;gap:10px;color:#0f0;font-size:1.5em;font-weight:bold;text-shadow:0 0 10px #0f0;text-decoration:none}.nav-logo{width:40px;height:40px;border-radius:50%}.nav-links{display:flex;gap:10px}.nav-link{padding:10px 18px;background:#000;border:2px solid #0f0;color:#0f0;text-decoration:none;border-radius:4px;transition:.3s;font-size:.95em}.nav-link:hover{background:#0f0;color:#000;transform:translateY(-2px)}.nav-link.active{background:#0f0;color:#000}.nav-divider{width:2px;height:20px;background:#0f0;opacity:.5}.container{flex:1;display:flex;align-items:center;justify-content:center;padding:40px 20px}.join-card{background:#0a0a0a;border:3px solid #0f0;padding:40px;box-shadow:0 0 30px rgba(0,255,0,.3);max-width:500px;width:100%;text-align:center}.join-title{font-size:2.5rem;color:#0f0;margin-bottom:20px;text-shadow:0 0 20px #0f0}.code-input{width:100%;padding:20px;font-size:2rem;text-align:center;border:3px solid #0f0;background:#000;color:#0f0;letter-spacing:.5rem;font-weight:bold;font-family:'Courier New',monospace;margin:20px 0}.join-btn{background:#0f0;color:#000;border:none;padding:20px;font-size:1.3rem;font-weight:bold;cursor:pointer;width:100%;font-family:'Courier New',monospace;transition:.3s}.join-btn:hover:not(:disabled){box-shadow:0 0 30px rgba(0,255,0,.8)}.join-btn:disabled{opacity:.5;cursor:not-allowed}.wallet-section{margin-top:30px;padding:20px;background:#000;border:2px solid #0f0;display:none}.wallet-section.active{display:block}.connect-wallet-btn{background:#000;color:#0f0;border:2px solid #0f0;padding:15px;font-size:1.1rem;font-weight:bold;cursor:pointer;width:100%;font-family:'Courier New',monospace;transition:.3s}.connect-wallet-btn:hover:not(:disabled){background:#0f0;color:#000}.msg{margin-top:20px;padding:15px;border:2px solid}.error{color:#f00;background:#1a0000;border-color:#f00}.success{color:#0f0;background:#001a00;border-color:#0f0}</style>
</head><body>
<nav class="navbar"><a href="index.html" class="nav-brand"><img src="solana-logo.png" class="nav-logo" alt="Solana">TRENCHER IQ</a>
<div class="nav-links"><a href="index.html" class="nav-link">Official Quiz</a><a href="browse.html" class="nav-link">Browse Quizzes</a><a href="create.html" class="nav-link">Create Quiz</a><div class="nav-divider"></div><a href="games.html" class="nav-link">Live Games</a><a href="host.html" class="nav-link">Host Game</a><a href="join.html" class="nav-link active">Join Game</a><div class="nav-divider"></div><a href="#" class="nav-link">Pump.fun</a><a href="#" class="nav-link">X Community</a></div></nav>
<div class="container"><div class="join-card"><h1 class="join-title">JOIN LIVE GAME</h1>
<input type="text" style="width:100%;padding:15px;margin-bottom:20px;border:3px solid #0f0;background:#000;color:#0f0;font-family:'Courier New',monospace;font-size:1.2rem" id="playerName" placeholder="Enter your name" maxlength="20">
<input type="text" class="code-input" id="code" placeholder="000000" maxlength="6">
<button class="join-btn" id="joinBtn" disabled>JOIN GAME</button>
<div class="wallet-section" id="wallet"><div style="margin-bottom:15px;font-weight:bold" id="status">Wallet not connected</div>
<button class="connect-wallet-btn" id="connectBtn">CONNECT PHANTOM</button></div><div id="msg"></div></div></div>
<script>let w=null,p=false;const code=document.getElementById('code'),btn=document.getElementById('joinBtn'),ws=document.getElementById('wallet'),cb=document.getElementById('connectBtn'),msg=document.getElementById('msg');
code.oninput=async e=>{e.target.value=e.target.value.replace(/[^0-9]/g,'');if(e.target.value.length===6){const r=await fetch('/api/games'),games=await r.json(),g=games.find(x=>x.code===e.target.value);if(!g){msg.innerHTML='<div class="msg error">Game not found</div>';btn.disabled=true;return}if(g.status!=='waiting'){msg.innerHTML='<div class="msg error">Already started</div>';btn.disabled=true;return}p=!g.isFreeGame;if(p){ws.classList.add('active');msg.innerHTML=`<div class="msg success">Prize: ${g.prizePool} SOL</div>`;btn.disabled=!w}else{ws.classList.remove('active');msg.innerHTML=`<div class="msg success">Free Game! ${g.players} waiting</div>`;btn.disabled=false}}else{btn.disabled=true;ws.classList.remove('active');msg.innerHTML=''}};
cb.onclick=async()=>{try{const pr=window.phantom?.solana;if(!pr){msg.innerHTML='<div class="msg error">Install Phantom</div>';return}const r=await pr.connect();w=r.publicKey.toString();document.getElementById('status').textContent='Connected: '+w.substr(0,8)+'...';cb.textContent='CONNECTED';cb.disabled=true;msg.innerHTML='<div class="msg success">Wallet connected!</div>';btn.disabled=false}catch(e){msg.innerHTML='<div class="msg error">'+e.message+'</div>'}};
window.onload=async()=>{try{const pr=window.phantom?.solana;if(pr){const r=await pr.connect({onlyIfTrusted:true});if(r.publicKey){w=r.publicKey.toString();document.getElementById('status').textContent='Connected';cb.textContent='CONNECTED';cb.disabled=true}}}catch(e){}};
btn.onclick=async()=>{const c=code.value;const name=document.getElementById('playerName').value.trim();if(!name){msg.innerHTML='<div class="msg error">Enter your name</div>';return}if(c.length!==6){msg.innerHTML='<div class="msg error">Enter 6 digits</div>';return}if(p&&!w){msg.innerHTML='<div class="msg error">Connect wallet</div>';return}try{btn.disabled=true;btn.textContent='JOINING...';const playerId=p?w:`player_${Date.now()}`;const r=await fetch(`/api/games/${c}/join`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({walletAddress:playerId,playerName:name})});const d=await r.json();if(!r.ok)throw new Error(d.error||'Failed');localStorage.setItem('playerName',name);localStorage.setItem('playerId',playerId);msg.innerHTML='<div class="msg success">Joining...</div>';setTimeout(()=>window.location.href=`/play-live.html?code=${c}&name=${encodeURIComponent(name)}`,1000)}catch(e){msg.innerHTML='<div class="msg error">'+e.message+'</div>';btn.disabled=false;btn.textContent='JOIN GAME'}};
</script></body></html>
